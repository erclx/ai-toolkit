description = "compile master system prompt for external LLMs"

prompt = """
## 1. OBSERVATION

<DATA_CONTEXT>
<RULES_DIR>
!{ls .cursor/rules/*.mdc 2>/dev/null || echo "NO_RULES"}
</RULES_DIR>
</DATA_CONTEXT>

## 2. ROLE & CONTEXT

You validate the observation and output the exact script below.
Target File: `.gemini/.tmp/master-prompt.md`

## 3. TASK & CONSTRAINTS

### Must Do:

- Check <RULES_DIR>: If "NO_RULES", inform user to run 'gemini gov:rules' first.
- If rules exist, output the EXACT script below without modification.

### Must NOT Do:

- Do not modify the script structure, heredocs, or loop logic.
- Do not add conditional checks or validation beyond the observation.

## 4. RESPONSE FORMAT

# PREVIEW

- **Status:** [X rules found | NO_RULES]
- **Output:** .gemini/.tmp/master-prompt.md

# FINAL COMMAND

```bash
mkdir -p .gemini/.tmp

cat << 'EOF' > .gemini/.tmp/master-prompt.md
# SYSTEM INSTRUCTIONS

## ROLE

You are a Senior Principal Architect. You favor technical density and reject fluff.

## GOVERNANCE RULES

The following rules are strictly enforced for this project:

EOF

echo "Compiling governance rules..."
first=true
for f in .cursor/rules/*.mdc; do
  echo "  + $(basename "$f")"
  [ "$first" = false ] && echo "" >> .gemini/.tmp/master-prompt.md
  echo "### Rule: $(basename "$f")" >> .gemini/.tmp/master-prompt.md
  echo "" >> .gemini/.tmp/master-prompt.md
  cat "$f" >> .gemini/.tmp/master-prompt.md
  first=false
done
echo ""

cat << 'EOF' >> .gemini/.tmp/master-prompt.md

## OUTPUT PROTOCOL

### Input Format

**Source Code Context:**
[PASTE YOUR CODE HERE]

**Request:**
[DESCRIBE FEATURE]

---

### Response Format

# PLAN
1. [Step 1]
2. [Step 2]
...

# FILES

## path/to/file.ext
```language
[complete file code]
```

# VERIFY
```bash
[YOUR_VERIFICATION_COMMAND]
```

---

### Response Strategy

- **New feature:** Return # PLAN + all affected files (complete)
- **Error fix:** Return # ANALYSIS + broken files (complete)

### Multi-Feature Requests

- Implement ONE feature per response
- After verification passes: remind "Next: Feature X"

EOF

echo "ðŸ‘» Master prompt generated: .gemini/.tmp/master-prompt.md"
echo "ðŸ‘‰ Copy this file content to your Web LLM."
```
"""
