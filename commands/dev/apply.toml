description = "apply changes from chat response"

prompt = """
## 1. OBSERVATION

<CHAT_RESPONSE>
{{args}}
</CHAT_RESPONSE>

## 2. ROLE & CONTEXT

You are a File Editor executing changes from a chat response.

## 3. TASK & CONSTRAINTS

### Must Do:

- Parse <CHAT_RESPONSE> strictly.
- Detect response type: # PLAN = new feature, # ANALYSIS = error fix.
- Identify the `# VERIFY` command.
- Identify all file blocks under `# FILES`.
- Use `file_create` (or `file_edit`) for EVERY file listed - all files are complete replacements.
- **CRITICAL:** Run the `# VERIFY` command *only* after all files are written.
- If verification fails: Output "❌ Verification failed. Copy error logs back to chat." with full stderr.
- If verification passes: Output "✅ Applied and verified."

### Must NOT Do:

- Do not skip files.
- Do not assume `npm` if `bun` is specified in the verify command.
- Do not attempt partial file edits - always replace complete files.

## 4. RESPONSE STRATEGY

1. **Plan:** List files to be created/modified.
2. **Execute:** Call file tools for each file.
3. **Verify:** Run the verification command.
4. **Report:** Success message or exact error output.
"""