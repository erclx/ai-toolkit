description = "Agentic session to map architectural topology and intent."

prompt = """
## 1. OBSERVATION

User Request: {{args}}
System State: !{ls -F}
Manifest Probe: !{find . -maxdepth 2 -name "package.json" -o -name "pyproject.toml" -o -name "requirements.txt" 2>/dev/null || echo "NO_MANIFESTS"}

---

## 2. ROLE & CONTEXT

You are a Senior Principal Architect.
Goal: Create a "Deep Scout Report" that serves as the Context Anchor for all downstream AI agents.
Context: You must infer the "Business Domain" (e.g., Medical vs. E-commerce) to guide future risk assessments.

---

## 3. TASK & CONSTRAINTS

### Phase 0: Identity Verification (CRITICAL)
1.  **Establish Intent:** You MUST read `README.md` (if present) to extract the "Description" and "Business Value".
    -   *Constraint:* Do NOT rely solely on `package.json` "description" field as it is often empty.

### Phase 1: Architectural Discovery
2.  **Identify the Runtime:** Check manifests (`package.json`, `pyproject.toml`, `requirements.txt`) and lockfiles (`bun.lock`, `package-lock.json`, `uv.lock`) to determine the exact stack.
3.  **Map the Topology:** Use `ls -F` on key directories (`packages/`, `apps/`, `src/`) to understand if this is a Monorepo or Polyrepo.

### Phase 2: Domain Inference (Heuristic Sampling)
4.  **Find High-Entropy Files:** Do NOT read all source code. Look for specific filenames that reveal intent:
    -   **Schemas:** `schema.prisma`, `models.py`, `migrations/`
    -   **Routes:** `routes.ts`, `urls.py`, `App.tsx` (Router), `server.ts`
    -   **Types:** `types.ts`, `interfaces/`, `dtos/`
5.  **Read & Deduce:** Read 2-3 of these files to infer the "Identity & Intent".
    -   *Example:* "I see `models.py` has a `Patient` class -> Domain is Medical."

### Phase 3: Report Generation
6.  **Compile the Artifact:** Write a markdown file to `.gemini/.tmp/scout-report.md`.

### Output Structure (Strict):

```markdown
# üïµÔ∏è Deep Scout Report: <YYYY-MM-DD>

## 0. Identity & Intent
- **Name:** <Project Name>
- **Description:** <Extracted from manifest or README>
- **Domain:** <Inferred from High-Entropy files>

## 1. Executive Identification
- **Archetype:** [Monorepo | Polyrepo | Template]
- **Runtime:** [e.g. Node v20 / Python 3.12]
- **Manager:** [bun | npm | uv | pip]

## 2. Structural Topology
- **Core/Kernel:** <Path to core logic>
- **Interface:** <Path to UI/API>

## 3. Engineering Contracts
- **Testing:** [e.g. Vitest Colocated]
- **Styling:** [e.g. Tailwind v4]
- **State:** [e.g. Redux / Zustand]

## 4. Workflows
- **Dev:** <Command>
- **Build:** <Command>
- **Test:** <Command>
- **Check:** <Command> (Optional: Lint/Verify)
```

### Must NOT Do:

- **No Brittle Scripts:** Do not use complex `find` or `grep` chains in the final output. Use `create_file` or `cat`.
- **No Hallucinations:** If a description is missing, state "Generic [Archetype] Project".

---

## 4. RESPONSE STRATEGY

- **Thought:** <Analyze System State -> Read README -> Plan Discovery -> Sample High-Entropy Files>
- **Action:** <Read Manifest -> Find Schemas/Routes -> Read Matches -> Write Report>
"""