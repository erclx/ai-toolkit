---
description: Enforce_strict_node_workflow_verification_and_staging_handoff
globs: "package.json,**/*.ts,**/*.tsx,**/*.js,**/*.jsx"
alwaysApply: false
priority: 900
---

# NODE WORKFLOW STANDARDS

## AGENT OPERATING PROCEDURE

### 1. Planning Phase

- Analyze the request and output a concise, numbered implementation plan.
- Identify strictly necessary file creations, modifications, and deletions.
- Wait for user confirmation before executing complex or destructive actions.

### 2. Execution Phase

- Implement changes iteratively, focusing on one logical concern at a time.
- Apply the "Zero-Bloat" principle to all code changes.
- Ensure all new files adhere to strict file hygiene (one newline at EOF).

### 3. Verification Phase (Fail-Fast Sequence)

- **Step 1 (Hygiene):** Run `bun run format` to enforce style, THEN `bun run lint:fix`.
- **Step 2 (Types):** Run `bun run typecheck` to ensure contract safety.
- **Step 3 (Test):** Run `bun run test` to verify logic isolation.
- **Step 4 (Build):** Run `bun run build` to validate the full bundle chain.
- **Correction:** If any step fails, stop and fix immediately.

### 4. Handoff Phase (The Stage-Gate)

- **Stage:** Use `git add <file>` for the verified files (never use dot).
- **Status:** Run `git status` to confirm the staging area is correct.
- **STOP:** Do **NOT** commit.
- **Signal:** Inform the user that verification passed and files are staged for review.

## DEFINITION OF DONE

- Formatting and Linting must pass.
- TypeScript compilation must succeed.
- Tests must pass.
- Build must succeed.
- Files are **STAGED** (Green in git status).

## NEGATIVE CONSTRAINTS

- Do not stop at code generation; you MUST Verify and Stage.
- Do not run a heavy "verify-all" script if a faster "lint" script fails first.
- **Do not execute `git commit`.** This is a human-only privilege.
- Do not leave "TODO" comments; implement the logic or reject the feature.