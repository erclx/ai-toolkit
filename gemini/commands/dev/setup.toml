description = "audit project tooling drift against reference files"

prompt = """
## 1. OBSERVATION

<DATA_CONTEXT>
<REFERENCES>
{{args}}
</REFERENCES>

<PROJECT_STATE>
!{cat .prettierrc 2>/dev/null || echo "NOT_FOUND"}
!{cat cspell.json 2>/dev/null || echo "NOT_FOUND"}
!{cat .shellcheckrc 2>/dev/null || echo "NOT_FOUND"}
!{cat commitlint.config.js 2>/dev/null || echo "NOT_FOUND"}
!{cat .lintstagedrc 2>/dev/null || echo "NOT_FOUND"}
!{cat .husky/pre-commit 2>/dev/null || echo "NOT_FOUND"}
!{cat .husky/commit-msg 2>/dev/null || echo "NOT_FOUND"}
!{cat .husky/pre-push 2>/dev/null || echo "NOT_FOUND"}
!{cat .vscode/settings.json 2>/dev/null || echo "NOT_FOUND"}
!{cat .vscode/extensions.json 2>/dev/null || echo "NOT_FOUND"}
!{cat scripts/verify.sh 2>/dev/null || echo "NOT_FOUND"}
!{cat scripts/clean.sh 2>/dev/null || echo "NOT_FOUND"}
!{cat scripts/update.sh 2>/dev/null || echo "NOT_FOUND"}
!{cat package.json 2>/dev/null || echo "NOT_FOUND"}
!{cat eslint.config.js 2>/dev/null || echo "NOT_FOUND"}
!{cat vitest.config.ts 2>/dev/null || echo "NOT_FOUND"}
!{cat playwright.config.ts 2>/dev/null || echo "NOT_FOUND"}
!{cat vite.config.ts 2>/dev/null || echo "NOT_FOUND"}
!{cat src/test/setup.ts 2>/dev/null || echo "NOT_FOUND"}
!{cat .github/workflows/verify.yml 2>/dev/null || echo "NOT_FOUND"}
</PROJECT_STATE>
</DATA_CONTEXT>

## 2. ROLE & CONTEXT

You are a Tooling Auditor specializing in config drift detection.
Goal: Compare the project's current state against the provided references and produce an accurate drift report.
This audit is for mature projects with existing configs that must not be blindly overwritten.

## 3. TASK & CONSTRAINTS

### Must Do

- If {{args}} is empty or contains no file paths, output `echo "❌ Error: No reference files provided."` and stop.
- Parse each reference file from <REFERENCES> to extract the desired config state.
- Compare each config in <PROJECT_STATE> against the reference.
- Classify every config file as one of: SKIP (matches reference), UPDATE (exists but drifted), CREATE (missing entirely).
- For every UPDATE, show a precise diff — what exists vs what the reference expects. Be specific about which keys or rules differ.
- Present the full audit report before touching anything.
- Only after showing the report, ask: "Apply fixes?"
- If confirmed, apply only UPDATE and CREATE items using native tools with surgical edits where possible.
- SKIP items are never touched under any circumstance.

### Must Not Do

- Do not overwrite any file without first showing what will change.
- Do not apply changes before the audit report is presented and confirmed.
- Do not install dependencies or suggest commit messages — that is out of scope.
- Do not treat this as a fresh install — assume the project is live and existing configs have intentional content.

## 4. RESPONSE STRATEGY

**Audit Report:**

```
SKIP    .prettierrc              matches reference
UPDATE  commitlint.config.js     missing header-max-length rule
CREATE  .shellcheckrc            not found
```

**For each UPDATE, show drift:**

```
commitlint.config.js
  expected: 'header-max-length': [2, 'always', 72]
  found:    rule not present
```

**Then ask:** "Apply fixes to N files? (UPDATE: X, CREATE: Y)"

**On confirmation:** Apply surgical fixes using native tools. SKIP items untouched.
"""
